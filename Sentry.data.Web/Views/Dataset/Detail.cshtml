@model Sentry.data.Web.BaseDatasetModel

@{
    ViewBag.Title = "View Dataset Details";
    string color = Model.DatasetCategory.Color;
}

<div>

    <a href="@Url.Action("List", "Dataset")" class="backToList" id="linkReturnToList"><span class="glyphicon glyphicon-chevron-left"></span>Back to list</a>
    

    @if (@Model.DatasetFiles.Count == 0)
    {
    <div id = "alertInfoBanner" class="alert alert-dismissable alert-info">
        <button type = "button" class="close" data-dismiss="alert">×</button>
        <div>
            @if (Model.CanUpload)
            {
                <strong class="alertHeading">Info: </strong>
                <span>This dataset has no files attached to it yet.  Please click the flashing upload button to upload your first file.</span>
            }
            else
            {
                <strong class="alertHeading">Info: </strong>
                <span>This dataset has no files attached to it yet.  Please contact the Sentry Owner: @Model.SentryOwner.FullName.</span>
            }
        </div>
       </div>

    }

    <div class="categoryBanner-@color categoryBannerSml rightFloat hidden-md hidden-lg">@Model.DatasetCategory.Name</div>

    <div class="relative hidden-sm hidden-xs">
        <div class="category-type-wrap-detail bg_gray BG_@color">
            <div class="category-type-detail categoryBanner-@color">
                @Model.DatasetCategory.Name
            </div>

            <div class="no-overflow">
                <h1 class="detailName leftFloat @color">
                    @Model.DatasetName

                    @if (Model.IsSensitive)
        {
                        <span class="glyphicon glyphicon-lock lockIcon" data-toggle="tooltip" data-placement="top" title="Secure"></span>
                    }
                </h1>

                @{
                    foreach (string item in Model.DistinctFileExtensions())
                    {
                        <div class="extension detailExt bg_gray htCenter ext_@item">@item</div>
    }
                }
                @*<div class="extension detailExt bg_gray htCenter ext_@Model.FileExtensionDisplay()">@Model.FileExtensionDisplay()</div>*@

                @if (Model.CanUpload)
                {
                    <button type="button" class="btn btn-default dataset-operation-button rightFloat borderdk_gray borderdk_@color" id="UploadModal" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Upload File">
                        <span class="glyphicon glyphicon-cloud-upload @color"></span>
                    </button>
                }

                @if (Model.CanEditDataset)
                {
                    <button type="button" class="btn btn-default btn dataset-operation-button rightFloat borderdk_gray borderdk_@color" id="EditDataset_@Model.DatasetId" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Edit Dataset">
                        <span class="glyphicon glyphicon-edit @color"></span>
                    </button>
                }

                @if (((Model.IsSensitive && Model.CanDwnldSenstive) || (!Model.IsSensitive && Model.CanDwnldNonSensitive)) && Model.DatasetFiles.Count != 0)
                {
                    <button type="button" class="btn btn-default btn dataset-operation-button rightFloat borderdk_gray borderdk_@color" id="DownloadLatest" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Download Latest">
                        <span class="glyphicon glyphicon-cloud-download @color"></span>
                    </button>
                }
                               
                @if ((Model.IsSensitive && Model.CanDwnldSenstive) || (!Model.IsSensitive && Model.IsPreviewCompatible))
                {
                    <button type="button" class="btn btn-default dataset-operation-button rightFloat borderdk_gray borderdk_@color" id="PreviewLatestData" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Preview Latest">
                        <span class="glyphicon glyphicon-search @color"></span>
                    </button>
                }
            </div>
        </div>
    </div>

    <div class="hidden-md hidden-lg">
        <h1 class="detailNameSml leftFloat @color BG_@color text-center">@Model.DatasetName</h1>

        <div class="clearFloat leftFloat iconExt">
            @if (Model.IsSensitive)
            {
                <div class="glyphicon glyphicon-lock lockIconSml leftFloat" data-toggle="tooltip" data-placement="top" title="Secure"></div>
            }
            <div class="extension detailExtSml bg_gray htCenter ext_@Model.FileExtensionDisplay()">@Model.FileExtensionDisplay()</div>
        </div>

        @if (Model.CanEditDataset)
        {
            <button type="button" class="btn btn-default btn dataset-operation-button borderdk_gray borderdk_@color rightFloat" id="EditDataset_@Model.DatasetId" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Edit Dataset">
                <span class="glyphicon glyphicon-edit @color"></span>
            </button>
        }

        @if ((Model.IsSensitive && Model.CanDwnldSenstive) || (!Model.IsSensitive && Model.CanDwnldNonSensitive))
        {
            <button type="button" class="btn btn-default btn dataset-operation-button borderdk_gray borderdk_@color rightFloat" id="DownloadDataset_@Model.DatasetId" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Download Latest">
                <span class="glyphicon glyphicon-cloud-download @color"></span>
            </button>
        }

        @if ((Model.IsSensitive && Model.CanDwnldSenstive && Model.IsPreviewCompatible) || (!Model.IsSensitive && Model.IsPreviewCompatible))
        {
            <button type="button" class="btn btn-default dataset-operation-button borderdk_gray borderdk_@color rightFloat" id="PreviewData" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Preview Latest">
                <span class="glyphicon glyphicon-search @color"></span>
            </button>
        }

    </div>

    <div class="detailDesc clearFloat">
        <h6>@Model.DatasetDesc</h6>
        <br/>
        <h7>@Model.DatasetInformation</h7>
    </div>

    <div>
        <div id="detailSectionHeader_Metadata">
            <span class="glyphicon glyphicon-chevron-down element detailSectionHeader section_arrow_datafiles" id="icon_detailSectionHeader_Metadata"></span>
            <h2 class="detailSection @color">Metadata</h2>
            @*<h2 class="detailSection @color">Data Files <i>(Latest Versions)</i></h2>*@
        </div>        
        <div id="hide_detailSectionHeader_Metadata">
            <table class="table table-striped table-hover detailTable">
                <tbody>
                    <tr class="borderMeta_@color">
                        <td class="borderMeta_@color colOneMeta">Sentry Owner</td>
                        <td class="borderMeta_@color">@Model.SentryOwner.FullName</td>
                    </tr>
                    <tr>
                        <td class="borderMeta_@color colOneMeta">Creation Date</td>
                        <td class="borderMeta_@color">@Model.DatasetDtm</td>
                    </tr>
                    <tr>
                        <td class="borderMeta_@color colOneMeta">Category</td>
                        <td class="borderMeta_@color">@Model.DatasetCategory.Name</td>
                    </tr>
                    <tr>
                        <td class="borderMeta_@color colOneMeta" title="Root location is: \\sentry.com\appfs_nonprod\">DFS Drop Location</td>
                        <td class="borderMeta_@color">@Model.DropLocation</td>
                        @if (HttpContext.Current.IsDebuggingEnabled)
                        {
                            <td class="borderMeta_@color"><button id="btnCreateDirectory">Create Directory</button></td>
                        }
                    </tr>
                    <tr>
                        <td class="borderMeta_@color colOneMeta">S3 Location</td>
                        <td class="borderMeta_@color">@Model.S3Key</td>
                    </tr>
                    <tr>
                        <td class="borderMeta_@color colOneMeta">Creation Frequency</td>
                        <td class="borderMeta_@color ">
                        @foreach (var dst in @Model.CreationFreqDesc)
                        {
                            <span class="comma" title='@dst'>@dst</span>
                        }
                        </td>
                    </tr>
                    <tr>
                        <td class="borderMeta_@color colOneMeta">Dataset Scope Type</td>
                        <td class="borderMeta_@color ">
                        @foreach (var dst in @Model.DatasetScopeType)
                        {
                            <span class="comma" title='@dst.Description'>@dst.Name</span>
                        }</td>
                    </tr>
                    <tr>
                        <td class="borderMeta_@color colOneMeta">Number of Datafiles to Keep</td>
                        <td class="borderMeta_@color">@Model.DatafilesFilesToKeep</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    @*<div class="datasetdetail-datasetfileconfigs">
        @Html.Action("DatasetFileConfigs", "Dataset", new { datasetFileConfigModels = Model.DatasetFileConfigs })
    </div>*@
    @*<div>
        <h2 class="detailSection @color">Data Files</h2>

        <div id="DatasetItemList" class="dataset-list inlineBlock text-left">
            <ul class="list-unstyled">
                @{
                    foreach (var item in Model.DatasetFiles)
                    {
                        //<li>@item.FileName</li>
                        @Html.Partial("_ListDatasetFile", item)
                    }
                }
            </ul>
        </div>
    </div>*@
    <div>
        <div id="detailSectionHeader_DataFiles">
            <span class="glyphicon glyphicon-chevron-down element detailSectionHeader section_arrow_datafiles" id="icon_detailSectionHeader_DataFiles"></span>
            <h2 class="detailSection @color">Data Files <i>(Latest Versions)</i></h2>
            @*<h2 class="detailSection @color">Data Files <i>(Latest Versions)</i></h2>*@
        </div>
        <div id="hide_detailSectionHeader_DataFiles">
            <div id="userToolbar">
               <button id="bundle_selected" type="button" class="btn btn-link" title="Bundle Selected Files">
                    <img src="~/Images/icons/bundle.png" />
                    Selected Files (<span id="bundleCountSelected">0</span> Selected)
                </button>
                <button id="bundle_allFiltered" type="button" class="btn btn-link" title="Bundle Filtered Files">
                    <img src="~/Images/icons/bundle.png" />
                    Filtered Files (<span id="bundleCountFiltered">0</span> Shown)
                </button>
            </div>

            <table class="table table-striped table-bordered @color" id="datasetFilesTable">
                <thead>
                    <tr class="filter-row">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="table-header_@color">
                        <th>Details</th>
                        <th>Actions</th>
                        <th>Name</th>
                        <th>Upload User Name</th>
                        <th>Initial Upload Date</th>
                        <th>Modified Date</th>
                        <th>Config File Name</th>
                        <th>Usable</th>
                    </tr>

                </thead>
                @*<tfoot>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tfoot>*@
                <tbody></tbody>
            </table>
        </div>
     </div>
    <div>
        <div id="detailSectionHeader_BundledFiles" style="display: none;">
            <span class="glyphicon glyphicon-chevron-down element detailSectionHeader section_arrow_datafiles" id="icon_detailSectionHeader_BundledFiles"></span>
            <h2 class="detailSection @color">Bundled Files <i>(By You)</i></h2>
        </div>
        <div id="hide_detailSectionHeader_BundledFiles" style="display: none;">
            <table class="table table-striped table-bordered @color" id="bundledDatasetFilesTable">
                <thead>
                    <tr class="filter-row">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="table-header_@color">
                        <th>Details</th>
                        <th>Actions</th>
                        <th>Name</th>
                        <th>Upload User Name</th>
                        <th>Initial Upload Date</th>
                        <th>Modified Date</th>
                        <th>Config File Name</th>
                        <th>Usable</th>
                    </tr>

                </thead>
                @*<tfoot>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>*@
                <tbody></tbody>
            </table>
        </div>
    </div>
    @{
        if (Model.CanManageConfigs)
        {
            <div>
                <div id="detailSectionHeader_DataFileConfigs">
                    <span class="glyphicon glyphicon-chevron-down element detailSectionHeader section_arrow_datafiles" id="icon_detailSectionHeader_DataFileConfigs"></span>
                    <h2 class="detailSection @color">Data File Configs</h2>
                </div>
                <div id="hide_detailSectionHeader_DataFileConfigs">
                    <div>
                        <a href="/Dataset/CreateDataFileConfig/@Model.DatasetId">Create new Data File Configuration</a>
                    </div>
                    <br />
                    <table class="table table-striped table-bordered " id="datasetFileConfigsTable">
                        <thead>
                            <tr role="row">
                                <th>Details</th>
                                <th>Actions</th>
                                <th>Config File Name</th>
                                <th>Search Criteria</th>
                                <th>Target File Name</th>
                                <th>Regex Search</th>
                                <th>Overwrite Dataset File</th>
                                <th>Versions To Keep</th>
                                <th>File Type ID</th>
                                <th>Frequency</th>
                                <th>Scope</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        }
    }

</div>

@section Scripts {

@Scripts.Render("~/bundles/dataTables")

    <script>
        var Id = @Model.DatasetId;
        $(function () {
            data.DatasetDetail.Init();

            if (@Model.DatasetFiles.Count == 0) {
                $("#UploadModal").css({ "animation": "blink 2s ease-in infinite" });
            }

            var returnUrl = "/Dataset/List/SearchPhrase";

            var text = JSON.parse(localStorage.getItem("searchText"));
            var storedNames = JSON.parse(localStorage.getItem("filteredIds"));

            if (text) {
                returnUrl += "?searchPhrase=" + text;

                if (storedNames) {
                    returnUrl += "&ids=";

                    for (i = 0; i < storedNames.length; i++) {
                        returnUrl += storedNames[i] + ',';
                    }
                    returnUrl = returnUrl.replace(/,\s*$/, "");
                }
            }
            else if (storedNames) {
                returnUrl += "?ids=";

                for (i = 0; i < storedNames.length; i++) {
                    returnUrl += storedNames[i] + ',';
                }
                returnUrl = returnUrl.replace(/,\s*$/, "");
            }

            $('#linkReturnToList').attr('href', returnUrl);

        });
    </script>
}
