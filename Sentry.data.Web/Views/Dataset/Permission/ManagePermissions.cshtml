@model Sentry.data.Web.ManagePermissionsModel
@{
    ViewBag.Title = "Manage Dataset Permissions";
}

<div class="mt-2">
    <a href="@Url.Action("Detail", "Dataset", new {id=Model.DatasetId})" id="linkReturnToDatasetDetails"><span class="icon-chevron-left pr-3"></span>Back to Dataset Details</a>
</div>


<div class="container">
    <div class="row">
        <div class="col-11 pl-0">
            <!-- Dataset Name and Request Access-->
            <h2 class="pt-2 mb-1" value="@Model.DatasetId" id="DatasetHeader">
                <em id="ManagePermissionDatasetName" class="font-style-normal">@Model.DatasetName</em> - Manage Permissions
            </h2>
        </div>
        <div class="col-1 pr-0">
            <div class="text-right">
                <a class="btn px-3"
                   id="RequestAccessButton" data-id="@Model.DatasetId" data-toggle="tooltip" data-placement="top" title="Request Additional Access">
                    <em class="fas fa-user-plus dsc-icon-button mr-0 sentry-dark-blue-text align-middle" id=""></em>
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <h5 class="pt-0">Permission Inheritance from @Model.DatasetSaidKeyCode: </h5>
        <div class="switch pl-2" id="inheritanceSwitch" value="@Model.InheritanceTicket.TicketStatus">
            <label class="pb-0">
                Off
                <input type="checkbox" id="inheritanceSwitchInput">
                <span class="lever" id="inheritanceLever"></span>
                On
            </label>
        </div>
    </div>

    @foreach (var pair in new Dictionary<string, IList<ManagePermissionModel>> { { "DSC Permissions", Model.DscPermissions }, { "Snowflake Permissions", Model.SnowflakePermissions }, { "S3 Permissions", Model.AwsIamPermissions }, { "DSC Legacy Permissions", Model.DscLegacyPermissions } })
    {
        <div class="row">
            <h6 class="pt-3">@pair.Key</h6>
        </div>
        <div class="row">
            <table class="table dsc-blue-table table-bordered table-hover nowrap" id="permissionsTable" aria-label="@pair.Key">
                <thead>
                    <tr class="table-header">
                        <th scope="col">Scope</th>
                        <th scope="col">Identity</th>
                        <th scope="col">Permission</th>
                        <th scope="col">Status</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    @if (pair.Value.Any())
                    {
                        foreach (var permission in pair.Value)
                        {
                            <tr id="@permission.TicketId">
                                <td class="permissionScope">@permission.Scope</td>
                                <td class="permissionIdentity">@permission.Identity</td>
                                <td class="permissionDescription">@permission.PermissionDescription</td>
                                <td class="permissionStatus"><span title="Change #@permission.TicketId">@permission.PermissionStatus</span></td>
                                <td class="permissionCode d-none">@permission.Code </td>
                                <td>@if (pair.Key.Equals("S3 Permissions") || pair.Key.Equals("DSC Legacy Permissions")) { <em class="far fa-trash-alt removePermissionIcon"></em> }</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5">No permissions found</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }

    <!-- Request Inheritance Modal -->
    @Html.Partial("Permission/_RequestInheritanceModal", Model.InheritanceRequest)
    @Html.Partial("Permission/_RemovePermissionModal", Model.RemovePermissionRequest)

</div>

@section Scripts {
    <script>
        $(function () {
            data.Dataset.managePermissionsInit();
        });
    </script>
}
