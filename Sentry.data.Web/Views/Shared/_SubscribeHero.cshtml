@model Sentry.data.Web.SubscriptionModel
@{
    ViewBag.Title = "Subscriptions";
}

@*Attach class to form because Notification.js uses class here to submit form because of quill*@
@using (Html.BeginForm("SubscribeUpdate", "Notification", FormMethod.Post, htmlAttributes: new { @class = "subscribeHeroForm" }))
{
    @Html.AntiForgeryToken()

<div class="form-horizontal">

    @Html.HiddenFor(model => model.businessAreaID)
    @Html.HiddenFor(model => model.SentryOwnerName)
    @Html.HiddenFor(model => model.group)
    @Html.DisplayFor((model) => ViewData.ModelState)


    <table class="table table-striped table-bordered">
        <thead>
            <tr class="table-header">
                <th>Event</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>

            @for (var subId = 0; subId < Model.SubscriptionsBusinessAreaModels.Count(); subId++)
            {

                @Html.HiddenFor(model => model.SubscriptionsBusinessAreaModels[subId].BusinessAreaType)
                @Html.HiddenFor(model => model.SubscriptionsBusinessAreaModels[subId].ID)
                @Html.HiddenFor(model => model.SubscriptionsBusinessAreaModels[subId].SentryOwnerName)
                @Html.HiddenFor(model => model.SubscriptionsBusinessAreaModels[subId].EventType.Type_ID)
                @Html.HiddenFor(model => model.SubscriptionsBusinessAreaModels[subId].EventType.DisplayName)
                @Html.HiddenFor(model => model.SubscriptionsBusinessAreaModels[subId].EventType.Description)
                @Html.HiddenFor(model => model.SubscriptionsBusinessAreaModels[subId].EventType.ParentDescription)

                string cssClass = "";
                if (Model.SubscriptionsBusinessAreaModels[subId].Interval.Description.ToLower().Contains("never"))
                {
                    cssClass = "unUsable";
                }
                else
                {
                    cssClass = "active";
                }

                <tr class="@cssClass">

                    @*COLUMN: DisplayName*@
                    @if (Model.SubscriptionsBusinessAreaModels[subId].Children != null && Model.SubscriptionsBusinessAreaModels[subId].Children.Count > 0)
                    {
                        //declare this so js can grab values
                        string multiSelectClass = "buford" + Model.SubscriptionsBusinessAreaModels[subId].EventType.DisplayName.Replace(" ", string.Empty);
                        <td>
                            @Html.ListBoxFor(model => model.SubscriptionsBusinessAreaModels[subId].ChildrenSelections,
                                                new MultiSelectList(Model.SubscriptionsBusinessAreaModels[subId].AllChildrenSelections, "Value", "Text", Model.SubscriptionsBusinessAreaModels[subId].ChildrenSelections, Model.SubscriptionsBusinessAreaModels[subId].ChildrenDisabledSelections),
                                                new { @Id = @multiSelectClass, @class = "select-wrapper mdb-select buford-multi-select", multiple = "" })
                        </td>
                    }
                    else
                    {
                        <td>
                            @Html.DisplayFor(model => model.SubscriptionsBusinessAreaModels[subId].EventType.DisplayName)
                        </td>
                    }


                    @*COLUMN: Interval_ID SELECTION DROP DOWN*@
                    <td>
                        @*There is something magical about how MVC interprets the model where I have to use model. notation below instead of the foreeach sub.  TODO: is to figure out what is happening behind the scenes*@
                        @Html.DropDownListFor(model => model.SubscriptionsBusinessAreaModels[subId].Interval.Interval_ID,
                                new SelectList(Model.AllIntervals, "Value", "Text", Model.SubscriptionsBusinessAreaModels[subId].Interval.Interval_ID))
                    </td>
                </tr>
            }


        </tbody>
    </table>


    <div class="modal-footer">
        <!-- Submit button triggers js function -->
        <input type="submit" value="Update Subscriptions" class="btn btn-primary"/>
        <input type="submit" class="btn btn-warning" data-dismiss="modal" value="Cancel" />
    </div>

</div>
}