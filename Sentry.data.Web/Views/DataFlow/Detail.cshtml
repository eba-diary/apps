@model DataFlowDetailModel

@{
    ViewBag.Title = "Data Flow Detail";
}

    <div class="detailContainer">
        <h2> @Model.Name - DataFlow Details </h2>
        <br />
        <h4>Associated Retriever Jobs</h4>
        @if (Model.AssociatedJobs == null || Model.AssociatedJobs.Count > 0)
        {
            <p><em>These jobs pull data from external sources and send it to this data flow.</em></p>
            <ul class="stepList">
                @foreach (int id in Model.AssociatedJobs)
                {
                    <li>
                        @Html.Action("_RetrieverJob", "Config", new { jobId = id })
                    </li>
                }
            </ul>
        }
        else
        {
            <p>There are no retriever jobs sending data to this data flow.</p>
        }
        <br />
        <hr />
        <h4>DataFlow Steps </h4>
        <ul class="stepList">
            @foreach (DataFlowStepModel step in Model.Step)
            {
                <li class="retJob @step.ActionName step">
                    <div class="jobHeader categoryBanner-blue">
                        <span><h6>@step.ExecutionOrder.ToString()</h6></span>
                        <h6>@step.ActionName</h6>
                        <em class="retJobDetails tracker-menu-icon glyphicon glyphicon-menu-up"></em>
                    </div>
                    <div class="jobContainer" style="display:none;">
                        <div><span>@step.ActionDescription</span></div>
                        <br />
                        <div><span><strong>This step processes files dropped in this AWS S3 url:</strong></span></div>
                        <div class="filePath"><span>@step.RootAwsUrl@step.TriggetKey</span></div>
                        @if (Model.UserSecurity.ShowAdminControls && step.TargetPrefix != null)
                        {
                            <div><span><strong>This step produces output to this long term storage url:</strong></span></div>
                            <div class="filePath"><span>@step.RootAwsUrl@step.TargetPrefix</span></div>
                        }
                    </div>
                </li>
            }
        </ul>
        <br />
        <hr />
        <h4><span>Target Schema</span></h4>
        <div id="targetSchema">
            <div id="targetSchemaSpinner"></div>
        </div>
    </div>
<style>
    .detailContainer {
        width: 75%;
    }

    .schemaMappingList, .stepList {
        list-style-type: none;
    }

    .schemaMappingList li, .stepList li {
        width: 75%
    }

    /*.stepList li span {
        vertical-align: middle;
    }*/

    .step-order{
        width:50px;
    }

    /*.jobHeader span{
        vertical-align: middle;
    }*/

    .filePath {
        margin-left: 30px;
    }

    .configDetailRow {
        padding-bottom: 15px;
    }

    .jobstatus {
        cursor: pointer;
        margin-right: 30px;
    }

    .configContainer {
        border-radius: 5px;
        border-top-left-radius: 0px;
        border-top-right-radius: 0px;
        background: white;
        border: 1px solid black;
        padding: 15px;
    }

    .configHeader {
        background-color: #555;
        color: white;
        display: inline-block;
        width: 100%;
        padding: 7px;
        cursor: pointer;
        border-radius: 5px 5px 5px 5px;
        font-weight: 700;
    }


        .configHeader h1 {
            color: white;
            padding-left: 15px;
            display: inline-block;
        }

        .configHeader .tracker-menu-icon {
            margin: 2px 10px 0 10px;
            color: white;
            display: inline-block;
        }

    .retJob {
        border-radius: 5px;
        background: white;
        padding-bottom: 5px;
    }

    .jobContainer {
        border-radius: 5px;
        border-top-left-radius: 0px;
        border-top-right-radius: 0px;
        background: white;
        border: 1px solid black;
        padding: 15px;
    }

    .jobHeader {
        background-color: #555;
        color: white;
        display: inline-block;
        width: 100%;
        padding: 7px;
        border-radius: 5px 5px 5px 5px;
        font-weight: 700;
    }

    .retJobDetails {
        cursor: pointer;
    }

    .jobHeader h6 {
        color: white;
        padding-left: 15px;
        display: inline-block;
    }

    .jobHeader .tracker-menu-icon {
        margin: 2px 10px 0 10px;
        color: white;
        display: inline-block;
    }

    .on-demand-run {
        margin-bottom: 3px;
    }
</style>
@section Scripts {
    <script>
        $(function () {
            data.DataFlow.DataFlowDetailInit(@Model.Id);
        });
    </script>
}