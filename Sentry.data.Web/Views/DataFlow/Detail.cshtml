@model DataFlowDetailModel

@{
    ViewBag.Title = "Data Flow Detail";
}

<div class="detailContainer ">
    <h1 class="pt-3 pl-0">DataFlow Details </h1>
    <div class="row pl-4">
        <h2 class="pt-1"> @Model.Name</h2>
        @if (Model.DisplayDataflowEdit)
        {
            <div id="edit-dataflow-icon" class="clickable" data-toggle="tooltip" data-placement="top" title="Edit DataFlow" onclick="data.DataFlow.EditUrlRedirect(@Model.Id)"><span class="far fa-edit"></span></div>
        }
    </div>
    @if (Model.ObjectStatus == Sentry.data.Core.GlobalEnums.ObjectStatusEnum.Pending_Delete)
    {
        <h3 style="color:red"><strong>Pending Delete - Data will not be processed through this data flow</strong></h3>
    }
    <div class="pl-4">
        <h4 class="pt-1">Associated Retriever Jobs</h4>
        <div class="d-block">
            @if (Model.AssociatedJobs == null || Model.AssociatedJobs.Count > 0)
            {
                <p><em>These jobs pull data from external sources and send it to this data flow.</em></p>
                <ul class="stepList">
                    @foreach (int id in Model.AssociatedJobs)
                    {
                        <li>
                            @Html.Action("_RetrieverJob", "Config", new { jobId = id })
                        </li>
                    }
                </ul>
            }
            else
            {
                <p>There are no retriever jobs sending data to this data flow.</p>
            }
        </div>
    </div>

    <hr />
    <h4 class="pt-3">DataFlow Steps </h4>
    <ul class="stepList">
        @foreach (DataFlowStepModel step in Model.Step)
        {
            <li class="retJob @step.ActionName step">
                <div class="jobHeader categoryBanner-blue">
                    <h6 class="pt-2">@step.ExecutionOrder.ToString()</h6>
                    <h6 class="pt-2">@step.ActionName</h6>
                    <em class="retJobDetails tracker-menu-icon fas fa-chevron-up"></em>
                </div>
                <div class="jobContainer" style="display:none;">
                    <div>@step.ActionDescription</div>
                    <br />
                    <div><strong class="bold">This step processes files dropped in this AWS S3 url:</strong></div>
                    <div class="filePath">@step.RootAwsUrl@step.TriggetKey</div>
                    @if (Model.UserSecurity.ShowAdminControls && step.TargetPrefix != null)
                    {
                        <div><strong class="bold">This step produces output to this long term storage url:</strong></div>
                        <div class="filePath">@step.RootAwsUrl@step.TargetPrefix</div>
                    }
                </div>
            </li>
        }
    </ul>
    <hr />
    <h4><span>Target Schema</span></h4>
    <div id="targetSchema">
        <div id="targetSchemaSpinner"></div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            data.DataFlow.DataFlowDetailInit(@Model.Id);
        });
    </script>
}